{% extends 'ifAnalytics/base.html' %}

{% block content %}
<script> //GRÁFICO FORMA DE INGRESSO

  let data_forma_ingresso

  function renderChartFormaIngresso(campusId, cursoId, ano, semestre, turmaId){
    //pegando os dados da view "get_data_forma_ingresso" para popular o gráfico
    $.ajax({
        method: "GET",
        url: '/get_data_forma_ingresso/', 
        data: {
          'campus_id' : campusId,
          'curso_id' : cursoId,
          'ano_turma' : ano,
          'semestre_turma' : semestre,
          'turma_id': turmaId
       },
       success: function(data_from_view){
         data_forma_ingresso = data_from_view
         google.charts.setOnLoadCallback(function() {drawChart_forma_ingresso(data_forma_ingresso);});
       },
       error: function(error_data){
          console.log("error")
          console.log(error_data)
       }
    })
  }

  // Populando o gráfico com dados
  function drawChart_forma_ingresso(data_forma_ingresso) {
     data = new google.visualization.DataTable();
     data.addColumn('string', 'Forma de Ingresso');
     data.addColumn('number', 'Alunos');

     for (let i = 0; i < data_forma_ingresso.length; i++) {
            data.addRows([data_forma_ingresso[i]]);
     }

     let options = {
            title: 'Forma de Ingresso',
            backgroundColor: '#E1F0DB',
            chartArea: {left: 10, height: 250, width: 600},
            legend: {textStyle: {fontSize: 10}},
            titleTextStyle: {fontSize:14, bold: true, color:'grey'},
            sliceVisibilityThreshold: 0,
     };

     let chart = new google.visualization.PieChart(document.getElementById('piechart_forma_ingresso'));


/////////////////////////////////////////////////////////////// testes de interatividade!!!
              function selectHandler() {
                  var selectedItem = chart.getSelection()[0];
                  if (selectedItem) {
                    var value = data.getValue(selectedItem.row, 0);
                      //var value = data.getValue(selectedItem.row, selectedItem.column); como estava no exemplo
                      alert('The user selected ' + value);

                      // o que eu quero aqui é que passe pra uma view o parametro da consulta que será executada
                      //para que o resultado dessa consulta preencha a tabela

                      //mais ou menos assim:
                      $.ajax({
                           url: '/consulta_forma_ingresso_detalhes/',
                           data: {
                                'parametro' : value
                            },
                     })
                      //criar a view consulta_forma_ingresso_detalhes na views.py, com as rotas e tudo mais
                     }
              }

                // Listen for the 'select' event, and call my function selectHandler() when
                // the user selects something on the chart.
                google.visualization.events.addListener(chart, 'select', selectHandler);
///////////////////////////////////////////////////////////////

     chart.draw(data, options);
  }
</script>


<script> //GRÁFICO STATUS DISCENTE - Segunda versão, usando parametros para chamar a função que desenha os gráficos

  let dados

  function renderChartStatusDiscente(campusId, cursoId, ano, semestre, turmaId){
    //pegando os dados da view "get_data_status_discente" para popular o gráfico
    $.ajax({
        method: "GET",
        url: '/get_data_status_discente/', 
        data: {
          'campus_id' : campusId,
          'curso_id' : cursoId,
          'ano_turma' : ano,
          'semestre_turma' : semestre,
          'turma_id': turmaId
       },
       success: function(data_from_view){
         dados = data_from_view
         google.charts.setOnLoadCallback(function() {drawGeralPizza(dados, 'Status dos Discentes', 'Alunos', 'Status dos Discentes', 'piechart_status_discente');});
       },
       error: function(error_data){
          console.log("error")
          console.log(error_data)
       }
    })
  }

  // Populando o gráfico com dados
  function drawGeralPizza(dados, coluna_string, number_string, titulo, id_div){
      data = new google.visualization.DataTable();
      data.addColumn('string', coluna_string);
      data.addColumn('number', number_string);

     for (let i = 0; i < dados.length; i++) {
            data.addRows([dados[i]]);
     }

     let options = {
            title: titulo,
            backgroundColor: '#E1F0DB',
            chartArea: {left: 10, height: 250, width: 600},
            legend: {textStyle: {fontSize: 10}},
            titleTextStyle: {fontSize:14, bold: true, color:'grey'},
            sliceVisibilityThreshold: 0,
     };

     let chart = new google.visualization.PieChart(document.getElementById(id_div));

     chart.draw(data, options);
  }
</script>


<script> //GRÁFICO TOTAL MATRICULAS

  let data_total_matriculas

  function renderChartTotalMatriculas(campusId, cursoId, ano, semestre, turmaId){
    //pegando os dados da view "get_data_total_matriculas" para popular o gráfico
    $.ajax({
        method: "GET",
        url: '/get_data_total_matriculas/', 
        data: {
          'campus_id' : campusId,
          'curso_id' : cursoId,
          'ano_turma' : ano,
          'semestre_turma' : semestre,
          'turma_id': turmaId
       },
       success: function(data_from_view){
         data_total_matriculas = data_from_view
         google.charts.setOnLoadCallback(function() {drawChart_total_matriculas(data_total_matriculas);});
       },
       error: function(error_data){
          console.log("error")
          console.log(error_data)
       }
    })
  }

  // Populando o gráfico com dados
  function drawChart_total_matriculas(data_total_matriculas) {
     data = new google.visualization.DataTable();
     data.addColumn('number', 'Disciplinas');
     data.addColumn('number', 'Alunos');

     for (let i = 0; i < data_total_matriculas.length; i++) {
            data.addRows([data_total_matriculas[i]]);
     }

     let options = {
            title: 'Quantidade de alunos matriculados em X disciplinas',
            hAxis: {
              title: 'Disciplinas'
            },
            vAxis: {
              title: 'Alunos'
            },
            backgroundColor: '#E1F0DB',
            chartArea: {left: 10, height: 250, width: 600},
            legend: {textStyle: {fontSize: 10}},
            titleTextStyle: {fontSize:14, bold: true, color:'grey'},
     };

     let chart = new google.visualization.ColumnChart(document.getElementById('piechart_total_matriculas'));

     chart.draw(data, options);
  }
</script>

<script> //GRÁFICO DISCENTES EVADIDOS

  let data_discentes_evadidos

  function renderChartDiscentesEvadidos(campusId, cursoId, ano, semestre, turmaId){
    //pegando os dados da view "get_data_discentes_evadidos" para popular o gráfico
    $.ajax({
        method: "GET",
        url: '/get_data_discentes_evadidos/', 
        data: {
          'campus_id' : campusId,
          'curso_id' : cursoId,
          'ano_turma' : ano,
          'semestre_turma' : semestre,
          'turma_id': turmaId
       },
       success: function(data_from_view){
         data_discentes_evadidos = data_from_view
         console.log("data from view: ");
         console.log(data_from_view);
         google.charts.setOnLoadCallback(function() {drawChart_discentes_evadidos(data_discentes_evadidos);});
       },
       error: function(error_data){
          console.log("error")
          console.log(error_data)
       }
    })
  }

  // Populando o gráfico com dados
  function drawChart_discentes_evadidos(data_discentes_evadidos) {
     data = new google.visualization.DataTable();
     data.addColumn('string', 'Discentes Evadidos');
     data.addColumn('number', 'Alunos');

     for (let i = 0; i < data_discentes_evadidos.length; i++) {
            data.addRows([data_discentes_evadidos[i]]);
     }

     let options = {
            title: 'Discentes Evadidos',
            backgroundColor: '#E1F0DB',
            chartArea: {left: 10, height: 250, width: 600},
            legend: {textStyle: {fontSize: 10}},
            titleTextStyle: {fontSize:14, bold: true, color:'grey'},
            sliceVisibilityThreshold: 0,
     };

     let chart = new google.visualization.PieChart(document.getElementById('piechart_discentes_evadidos'));

     chart.draw(data, options);
  }
</script>

<div id="dashboards">
	<!-- Plotagem do gráfico -->
	<div id="piechart_forma_ingresso" class="grafico alinha_grafico_esquerda"></div>
  <div id="piechart_status_discente" class="grafico alinha_grafico_direita"></div>
  <div id="piechart_total_matriculas" class="grafico alinha_grafico_esquerda"></div>
  <div id="piechart_discentes_evadidos" class="grafico alinha_grafico_direita"></div>
</div>
{% endblock %}